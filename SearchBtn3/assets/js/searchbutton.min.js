/**
 * Jellybo SearchButton003 , JavaScript search button animation
 *
 * @license Copyright (c) 2017, Jellybo. All rights reserved, http://tech.jellybo.com/doc/license.html
 * To use this plugin you must buy our product in http://jellybo.com.
 * @author  Marian Spisiak
 * @created 2017-07-27
 * @link    http://jellybo.com
 */

var Jellybo=Jellybo||{};Jellybo._prefix="jellybo",Jellybo.BootLoader=function(t){var n={pluginName:"",animationFactory:null,publicFunctions:null,selector:"",settingAttributes:null},i=Jellybo._prefix;return function(e){function o(n,i){return function(){var e=null,o=arguments;return n.each(function(){var n=t(this).data(f);e=n[i].apply(n,o)}),e}}function a(t){var n={};for(var i in u.publicFunctions)n[u.publicFunctions[i]]=o(t,u.publicFunctions[i]);return n}function r(t,n){return function(){return t[n].apply(t,arguments)}}function l(n,i){var e={};for(var o in u.settingAttributes){var a=u.settingAttributes[o].toString().toLowerCase();n.data(a)&&(e[a]=n.data(a))}1===i.length&&t.extend(e,i[0]);var l=u.animationFactory(n,e),s={};l.init(),s.settings=r(l,"settings");for(var o in u.publicFunctions)s[u.publicFunctions[o]]=r(l,u.publicFunctions[o]);return s}function s(){return function(){var n=arguments;return this.each(function(){t(this).data(f)?1===n.length&&t.isPlainObject(n[0])&&t(this).data(f).settings(n[0]):t(this).data(f,l(t(this),n))}),a(this)}}function c(){t.fn[u.pluginName]=s()}var u={};t.extend(u,n,e);var f=i+"animation_plugin_"+u.pluginName;return function(){return c(),t(function(){t(u.selector)[u.pluginName]()}),null}()}}($),Jellybo.SearchButton3=function(t,n,i){function e(n,i){function e(i,e){n.on(i,function(){t.isFunction(e)?e.apply(this,arguments):window[e].apply(this,arguments)})}for(var o in i)for(var a in s)o.toString().toLowerCase()===a.toString().toLowerCase()&&e(s[a],i[o])}function o(t){t.attr({visibility:"hidden"})}function a(t){t.attr({visibility:"visible"})}function r(n,i,e){for(var o in i)t.inArray(o,e)<0&&(n[o]=i[o])}var l={width:450,height:40,color_1:"#fff",color_2:"#fff",list_bg_color:"rgba(255,255,255,0.2)",line_stroke:2,magnifier_stroke:1.5,duration:600,duration_colorChange:300,duration_input:400,placeholder:"SEARCH"},s={onSubmit:"event_submit",onItemSelect:"event_itemClick",onChange:"event_change",onItemHighlight:"event_itemHighlight",onOpen:"event_open",onClose:"event_close"},c=[];for(var u in s)c.push(u);return function(u,f){function h(t){return t.find("span").text()}function g(t,n){t.find("span").text(n)}function p(t){T.append('<li class="item"><span></span></li>'),g(T.find("li").last(),t)}function d(){T.html("")}function v(t){d();for(var n in t)p(t[n])}function m(t){V.val(t)}function _(){return V.val()}function b(n){j=t(n),j.html('<div class="jellyboSearchButton003Wrapper"><svg class="animation"></svg><input class="input"/><span class="button"></span><div class="listWrapper"><ul class="list"></ul></div></div>'),N=j.find("svg"),V=j.find("input"),P=j.find("span"),T=j.find("ul"),O=j.find(".listWrapper"),M=j.find(".searchBar"),M.css("width",Y),M.css("height",X);var i=10;V.css("width",Y),V.css("height",X),V.css("padding-left",tt+i),V.css("padding-right",2*tt),V.css("color",H.color_1),P.css("width",2*tt),P.css("height",X),T.css("min-width",it+tt-1),O.css("left",tt+Math.floor(U+1)),T.css("color",H.color_1),O.css("background",H.list_bg_color),O.css("top",H.height),V.hide(),O.hide(),V.attr("placeholder",H.placeholder)}function y(t){$=n(t[0]),$.attr({width:Y,height:X,style:"display: inline-block; position: relative; "})}function k(){var t=it+tt+U+","+U,n="M"+t+"a"+tt+","+tt+",0,0,0,0,"+Z+"a"+tt+","+tt+",0,1,0,0,-"+Z+"l-"+it+",0a"+tt+","+tt+",0,1,0,0,"+Z+"l"+(it+tt)+",0";E=$.path(n),z=E.getTotalLength(),G=2*Math.PI*tt,K=Math.ceil(it+tt),R=$.circle(it+Z/2+U,Z/2+U,tt),R.attr({stroke:H.color_1,fill:"none",strokeWidth:Q}),E.attr({stroke:H.color_1,fill:"none",strokeWidth:Q,strokeDasharray:G+"px "+(z-G)+"px",strokeDashoffset:"0px",strokeLinecap:"butt"}),o(E)}function C(){var t=1,i=1,e=0,o=it+Z/2+U+i,a=Z/2+U+e,r=2*tt-tt/t,l=.75*r/2,s=.25*r+1,c=o-r/2+l,u=a-r/2+l,f=.70710678118,h=l*f,g=l*f,p=$.circle(c,u,l),d=$.path("M"+(c+h)+","+(u+g)+" l"+s+","+s),v=$.filter(n.filter.shadow(0,0,1,H.color_2,.5));d.attr({stroke:H.color_2,fill:"none",strokeWidth:nt,strokeLinecap:"round",filter:v}),p.attr({stroke:H.color_2,fill:"none",strokeWidth:nt,filter:v})}function w(t,n,i){return t+(n-t)*i}function S(t){o(R),a(E),E.animate({stroke:H.color_2},H.duration_colorChange),setTimeout(function(){V.show(),V.css({opacity:0}),V.animate({opacity:1},H.duration_input)},et-H.duration_input),n.animate(0,1,function(t){E.attr({strokeDasharray:w(G,K,t)+"px,"+w(z-G,z-K,t)+"px"}),E.attr({strokeDashoffset:-w(0,z-K,t)+"px"})},et,i.easeinout,function(){O.show(),V.focus(),t()})}function x(t){O.hide(),V.animate({opacity:0},H.duration_input).promise().then(function(){V.hide()}),setTimeout(function(){E.animate({stroke:H.color_1},H.duration_colorChange)},et-H.duration_colorChange),n.animate(0,1,function(t){E.attr({strokeDasharray:w(K,G,t)+"px,"+w(z-K,z-G,t)+"px"}),E.attr({strokeDashoffset:-w(z-K,0,t)+"px"})},et,i.easeinout,function(){o(E),a(R),t()})}function L(){1===ot&&(ot=2,j.trigger(s.onOpen,[t(V).val()]),S(function(){ot=0}))}function I(){0===ot&&(ot=3,j.trigger(s.onClose,[t(V).val()]),x(function(){ot=1}))}function F(){var t=V.val();j.trigger(s.onChange,[t,!1])}function D(){var n=null;T.find("li").each(function(){t(this).hasClass("active")&&(n=h(t(this)))}),null!==n&&(V.val(n),j.trigger(s.onItemSelect,[t(V).val()]),j.trigger(s.onChange,[_(),!0])),j.trigger(s.onSubmit,[t(V).val()])}function B(){var n=0,i=-1;T.find("li").each(function(){t(this).hasClass("active")&&(i=n+1,t(this).removeClass("active")),n++}),i>=0?i>=n&&(i=n-1):i=0,T.find("li").eq(i).addClass("active"),T.find("li").length>0&&(V.val(h(T.find("li").eq(i))),j.trigger(s.onItemHighlight,h(T.find("li").eq(i))))}function J(){var n=0,i=-1;T.find("li").each(function(){t(this).hasClass("active")&&(i=n-1,t(this).removeClass("active")),n++}),i>=0?i>=n&&(i=0):i=0,T.find("li").eq(i).addClass("active"),T.find("li").length>0&&(V.val(h(T.find("li").eq(i))),j.trigger(s.onItemHighlight,h(T.find("li").eq(i))))}function W(t){m(h(t)),j.trigger(s.onItemSelect,[h(t)]),j.trigger(s.onChange,[_(),!0])}function q(){P.click(function(){1===ot?L():(at.noClose=!0,V.focus(),D())}),V.blur(function(t){t.preventDefault(),setTimeout(function(){at.noClose===!1?I():at.noClose=!1},300)}),V.keypress(function(t){13===t.which&&D()}),V.keydown(function(t){38===t.which&&(t.preventDefault(),J()),40===t.which&&(t.preventDefault(),B())}),V.on("input",function(){F()}),T.on("click",".item span",function(){at.noClose=!0,V.focus(),W(t(this).parent("li"))})}function A(t){r(H,t,c),e(j,t)}var H={};t.extend(H,l),r(H,f,c);var j,M,N,O,T,V,P,$,E,R,z,G,K,Q=H.line_stroke,U=1===Q?1:Q/2,X=H.height,Y=H.width,Z=X-2*U,tt=Z/2,nt=H.magnifier_stroke,it=H.width-2*tt-2*U,et=H.duration,ot=1,at={noClose:!1};return{init:function(){b(u),y(N),k(),C(),e(j,f),q()},setValue:m,getValue:_,emptyList:d,addListItem:p,setListItems:v,settings:A,open:function(){L()},close:function(){I()},clear:function(){d(),m("")}}}}($,Snap,mina),Jellybo.BootLoader({pluginName:"jellyboSearchButton003",animationFactory:Jellybo.SearchButton3,publicFunctions:["getValue","setValue","emptyList","addListItem","setListItems","open","close","clear"],selector:".jellybo-SearchBar003",settingAttributes:["width","height","onChange","color_1","color_2","list_bg_color","placeholder","onSubmit","onItemSelect","onItemHighlight","line_stroke","magnifier_stroke","onOpen","onClose"]});